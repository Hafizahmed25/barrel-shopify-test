{% include 'account-titles' %}

<section class="outer mt2">
  <div class="container--s mha pt1">
    <h1 class="h2 mv0">Order {{order.name}}</h1>
    <p class="block mt0 mb05">{{order.created_at | date: '%b %d, %Y'}}</p>

    <div class="order__meta order__meta--total inline-block h5">
      <span>Total:</span><span>{{order.total_price | money}}</span>
    </div>
    <div class="order__meta inline-block h5">
      <span>Payment:</span><span>{{order.financial_status_label}}</span>
    </div>
    <div class="order__meta inline-block h5">
      <span>Shipping:</span><span>{{order.fulfillment_status_label}}</span>
    </div>
  </div>
</section>

<section class="outer mt2">
  <div class="container--s mha pv1">

    {% if order.cancelled %}
      <div class="px1 flex items-center justify-center w1">
        <div class="alert__icon mr1 flex">
          <svg viewBox='0 0 18 18'>
            <use xlink:href="#alert-icon" x='0' y='0'></use>
          </svg>
        </div>

        {% assign cancelled_at = order.cancelled_at | date: "%B %d, %Y %I:%M%p" %}
        <p class="h5">Order canceled: {{ cancelled_at }}</p>
        <p>Reason: {{ order.cancel_reason }}</p>
      </div>
    {% endif %}

    <h2 class="h4 mb05 mt0 uppercase">Details</h2>

    <ul class="order__details block relative w1">
      {% for item in order.line_items %}
        {% assign url = item.product.url %}
        {% assign image = item.image | img_url: '100x' %}
        {% assign title = item.product.title %}
        {% assign variant = item.variant %}
        {% assign price = item.price %}
        {% assign props = item.properties %}
        {% assign sku = item.sku %}
        {% assign quantity = item.quantity %}
        {% assign created_at = item.fulfillment.created_at | date: '%b %d, %Y' %}
        {% assign tracking_url = line_item.fulfillment.tracking_url %}
        {% assign tracking_number = line_item.fulfillment.tracking_number %}

        <li class="order__details__row flex flex-wrap flex-items-start px1">
          <div class="__image">
            <a href="{{url}}"><img src="{{image}}" class="w1"/></a>
          </div>

          <div class="__info">
            <a href="{{url}}"><h4 class="inline-block mv0">{{title}}</h4></a>
            <p class="mv0">
              {% if variant.title != 'Default title'%}{{variant.title}}<br/>{% endif %}
              {% if quantity > 1 %}<strong>Quantity:</strong> {{quantity}}<br/>{% endif %}
              {% if sku != blank %}<strong>SKU:</strong> {{sku}}<br/>{% endif %}

              {% unless props == 'empty '%}
                {% for p in props %}
                  <strong>{{p.first}}:</strong> {{p.last}}<br/>
                {% endfor %}
              {% endunless %}
            </p>


            {% if item.fulfillment and tracking_number %}
              <div class="mt05">
                <a href="{{tracking_url}}" class="order__meta inline-block h5">
                  <span>Track:</span><span>{{tracking_number}}</span>
                </a>
              </div>
            {% endif %}
          </div>

          <div class="__total flex-auto">
            <h4 class="mv0 c1">{{quantity | times: price | money}}</h4>
          </div>
        </li>
      {% endfor %}
    </ul>


    <div class="clear">
      <div class="order__totals w1 mv2">
        <div class="table w1">
          <div class="table__row">
            <div class="table__cell pv05">
              Subtotal 
            </div>
            <div class="table__cell pv05 align-r">
              {{ order.subtotal_price | money }}
            </div>
          </div>

          {% for discount in order.discounts %}
            <div class="table__row pv1 order_summary discount">
              <div class="table__cell pv05">Discount: {{ discount.code }}</div>
              <div class="table__cell pv05 align-r">{{ discount.savings | money }}</div>
            </div>
          {% endfor %}

          {% for shipping_method in order.shipping_methods %}
            <div class="table__row">
              <div class="table__cell pv05">
                Shipping:<br>
                <span class="p00">({{ shipping_method.title }})</span>
              </div>
              <div class="table__cell pv05 align-r">{{ shipping_method.price | money }}</div>
            </div>
          {% endfor %}

          {% for tax_line in order.tax_lines %}
            <div class="table__row">
              <div class="table__cell pv05">
                Tax:<br>
                <span class="p00">({{ tax_line.title }} @ {{ tax_line.rate | times: 100 }}%)</span>
              </div>
              <div class="table__cell pv05 align-r">{{ tax_line.price | money }}</div>
            </div>
          {% endfor %}
        </div>

        <div class="order__total align-r pt1 mt1">
          <p class="h3">Total: <span class="c1">{{order.total_price | money}} {{order.currency}}<span></p>
        </div>
      </div>
    </div>

    <div class="flex flex-wrap flex-justify mhn1 mt2">
      <div class="address w1 w12_m ph1 mb1 auto-height">
        <h4 class="uppercase mb1">Billing</h4>
        <div class="address__inner pv2 ph2 bg-cg1 relative">
          <div class="address__info p">
            {{ order.billing_address.name | capitalize }}<br>
            {% if address.company != '' %}{{ order.billing_address.company }}<br>{% endif %}
            {{ order.billing_address.street }}<br>
            {{ order.billing_address.city | capitalize }}{% if order.billing_address.province %}, {{ order.billing_address.province | upcase }} {% endif %} {{ order.billing_address.zip | upcase }}<br>
            {{ order.billing_address.country }}<br>
            {{ order.billing_address.phone }}
          </div>
        </div>
      </div>

      <div class="address w1 w12_m ph1 mb1 auto-height">
        <h4 class="mb1 uppercase">Shipping</h4>
        <div class="address__inner pv2 ph2 bg-cg1 relative">
          <div class="address__info p">
            {{ order.shipping_address.name | capitalize }}<br>
            {% if address.company != '' %}{{ order.shipping_address.company }}<br>{% endif %}
            {{ order.shipping_address.street }}<br>
            {{ order.shipping_address.city | capitalize }}{% if order.shipping_address.province %}, {{ order.shipping_address.province | upcase }} {% endif %} {{ order.shipping_address.zip | upcase }}<br>
            {{ order.shipping_address.country }}<br>
            {{ order.shipping_address.phone }}
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
